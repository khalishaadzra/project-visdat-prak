<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Work-Life Balance Analysis</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f8f9fa;
    }
    h1, h2 {
      text-align: center;
      color: #2c3e50;
    }
    .chart-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
    }
    .chart-container div {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .heatmap-container {
      margin-top: 40px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .legend {
      width: 300px;
      height: 20px;
      background: linear-gradient(to right, #edf8b1, #7fcdbb, #2c7fb8);
      margin-top: 20px;
      position: relative;
      border: 1px solid #ccc;
    }
    .legend-labels {
      display: flex;
      justify-content: space-between;
      width: 300px;
      font-size: 12px;
      margin-top: 5px;
    }
    .tooltip {
      position: absolute;
      text-align: center;
      padding: 8px;
      font-size: 12px;
      background: #333;
      color: #fff;
      border-radius: 4px;
      pointer-events: none;
      opacity: 0;
    }
  </style>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <h1>Hubungan Jam Kerja, Aktivitas Fisik, dan Work-Life Balance</h1>

  <div class="chart-container">
    <div>
      <h2>Jam Kerja vs Work-Life Balance</h2>
      <svg id="barChartHours" width="500" height="350"></svg>
    </div>
    <div>
      <h2>Aktivitas Fisik vs Work-Life Balance</h2>
      <svg id="barChartPhysical" width="500" height="350"></svg>
    </div>
  </div>

  <h2>Gabungan: Heatmap Jam Kerja Ã— Work-Life Balance Rating</h2>
  <div class="heatmap-container">
    <svg id="heatmap" width="700" height="500"></svg>
    <div class="legend" id="legend"></div>
    <div class="legend-labels">
      <span id="minValue">0</span>
      <span id="maxValue">100</span>
    </div>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <script>
    d3.csv("data/cleaned_data.csv").then(function(data) {
      data.forEach(d => {
        d.Hours_Worked_Per_Week = +d.Hours_Worked_Per_Week;
        d.Physical_Activity = d.Physical_Activity;
        d.Work_Life_Balance_Rating = +d.Work_Life_Balance_Rating;
      });

      const hoursGrouped = d3.groups(data, d => Math.floor(d.Hours_Worked_Per_Week/20)*20)
        .map(([hours, values]) => ({
          Hours_Group: `${hours}-${hours+19}`,
          Avg_WLB: d3.mean(values, d => d.Work_Life_Balance_Rating)
        }));

      const activityGrouped = d3.groups(data, d => d.Physical_Activity)
        .map(([activity, values]) => ({
          Activity: activity,
          Avg_WLB: d3.mean(values, d => d.Work_Life_Balance_Rating)
        }));

      const tooltip = d3.select("#tooltip");

      function createBarChart(svgId, data, xKey, yKey, xLabel) {
        const svg = d3.select(svgId);
        const margin = { top: 20, right: 20, bottom: 50, left: 50 };
        const width = +svg.attr("width") - margin.left - margin.right;
        const height = +svg.attr("height") - margin.top - margin.bottom;

        const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

        const x = d3.scaleBand()
          .domain(data.map(d => d[xKey]))
          .range([0, width])
          .padding(0.3);

        const y = d3.scaleLinear()
          .domain([0, 5])
          .range([height, 0]);

        const color = d3.scaleLinear()
          .domain([1, 5])
          .range(["#A2D9CE", "#117864"]);

        g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x));
        g.append("g").call(d3.axisLeft(y));

        g.selectAll(".bar")
          .data(data)
          .enter().append("rect")
          .attr("class", "bar")
          .attr("x", d => x(d[xKey]))
          .attr("width", x.bandwidth())
          .attr("y", height)
          .attr("height", 0)
          .attr("fill", d => color(d[yKey]))
          .on("mouseover", (event, d) => {
            tooltip.transition().duration(200).style("opacity", 0.9);
            tooltip.html(`${xLabel}: <b>${d[xKey]}</b><br>Rating: <b>${d[yKey].toFixed(2)}</b>`)
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 28) + "px");
          })
          .on("mouseout", () => tooltip.transition().duration(500).style("opacity", 0))
          .transition()
          .duration(1000)
          .attr("y", d => y(d[yKey]))
          .attr("height", d => height - y(d[yKey]));
      }

      createBarChart("#barChartHours", hoursGrouped, "Hours_Group", "Avg_WLB", "Jam Kerja/Minggu");
      createBarChart("#barChartPhysical", activityGrouped, "Activity", "Avg_WLB", "Aktivitas Fisik");

      const heatmapSvg = d3.select("#heatmap");
      const margin = { top: 30, right: 30, bottom: 70, left: 70 },
        width = +heatmapSvg.attr("width") - margin.left - margin.right,
        height = +heatmapSvg.attr("height") - margin.top - margin.bottom;

      const g = heatmapSvg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

      const hourGroups = [...new Set(data.map(d => `${Math.floor(d.Hours_Worked_Per_Week/20)*20}-${Math.floor(d.Hours_Worked_Per_Week/20)*20+19}`))];
      const ratingGroups = [1, 2, 3, 4, 5];

      const heatX = d3.scaleBand().domain(hourGroups).range([0, width]).padding(0.05);
      const heatY = d3.scaleBand().domain(ratingGroups).range([height, 0]).padding(0.05);

      g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(heatX));
      g.append("g").call(d3.axisLeft(heatY));

      const counts = {};
      data.forEach(d => {
        const key = `${Math.floor(d.Hours_Worked_Per_Week/20)*20}-${Math.floor(d.Hours_Worked_Per_Week/20)*20+19}_${d.Work_Life_Balance_Rating}`;
        counts[key] = (counts[key] || 0) + 1;
      });

      const maxCount = d3.max(Object.values(counts));
      document.getElementById('maxValue').textContent = maxCount;

      const colorScale = d3.scaleSequential(d3.interpolateYlGnBu)
        .domain([0, maxCount]);

      const matrix = [];
      hourGroups.forEach(h => {
        ratingGroups.forEach(r => {
          const value = counts[`${h}_${r}`] || 0;
          matrix.push({hour: h, rating: r, value: value});
        });
      });

      g.selectAll()
        .data(matrix)
        .enter().append("rect")
        .attr("x", d => heatX(d.hour))
        .attr("y", d => heatY(d.rating))
        .attr("width", heatX.bandwidth())
        .attr("height", heatY.bandwidth())
        .style("fill", d => colorScale(d.value))
        .on("mouseover", (event, d) => {
          tooltip.transition().duration(200).style("opacity", 0.9);
          tooltip.html(`Jam Kerja: <b>${d.hour}</b><br>Rating: <b>${d.rating}</b><br>Jumlah: <b>${d.value}</b>`)
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", () => tooltip.transition().duration(500).style("opacity", 0));
    });
  </script>

</body>
</html>